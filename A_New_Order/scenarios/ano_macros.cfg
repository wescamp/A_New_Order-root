#textdomain wesnoth-A_New_Order
#define EGETUNIT_ATTR WHAT VAR
	[store_unit]
		variable=ano_tmp
		[filter]
			x=$x1
			y=$y1
		[/filter]
	[/store_unit]
	{MESSAGE (narrator) (getunit $x1 : $y1 : $ano_tmp.description)}
	[set_variable]
		name={VAR}
		value=$ano_tmp.{WHAT}
	[/set_variable]
	{CLEAR_VARIABLE ano_tmp}
#enddef

#define SETVAL NAME VARIABLE VALUE
        [store_unit]
        variable=tmp
        kill=yes
                [filter]
                description={NAME}
                [/filter]
        [/store_unit]
        [set_variable]
        name=tmp.{VARIABLE}
        value={VALUE}
        [/set_variable]
        [unstore_unit]
        variable=tmp
        [/unstore_unit]
        [clear_variable]
        name=tmp
        [/clear_variable]
#enddef

#define OPVAL NAME VARIABLE OP VALUE
        [store_unit]
        variable=tmp
        kill=yes
                [filter]
                description={NAME}
                [/filter]
        [/store_unit]

		[message]
			speaker=narrator
			message=$tmp.{VARIABLE}
		[/message]
        [set_variable]
        name=tmp.{VARIABLE}
        {OP}={VALUE}
        [/set_variable]
		[message]
			speaker=narrator
			message=$tmp.{VARIABLE}
		[/message]
        [unstore_unit]
        variable=tmp
        [/unstore_unit]
        [clear_variable]
        name=tmp
        [/clear_variable]
#enddef

#define ANO_ASSASSIN
	[event]
		name=attack
		[filter]
			description=Assassin
		[/filter]
        [filter_second]
            [not]
                description=Gawen Hagarthen
            [/not]
        [/filter_second]
		[message]
			speaker=Assassin
			message=_"Get out of my way... I am not here because of you."
		[/message]
	[/event]

	[event]
		name=die
		[filter]
            [not]
                description=Gawen Hagarthen
            [/not]
		[/filter]
        [filter_second]
				description=Assassin
        [/filter_second]
		[message]
			speaker=Assassin
			message=_"You aren't prince, aren't you? It is not you whom I am seeking."
		[/message]
	[/event]

	[event]
		name=attack
		[filter]
			description=Assassin
		[/filter]
        [filter_second]
			description=Gawen Hagarthen
        [/filter_second]
		[message]
			speaker=Assassin
			message=_"Finally! Now, accept the inevitable. I am professional, that won't gonna hurt"
		[/message]
	[/event]

	[event]
		name=attack
		[filter]
			[not]
			description=Lady Lorin
			[/not]
		[/filter]
        [filter_second]
			description=Assassin
        [/filter_second]
		[message]
			speaker=Lady Lorin
			message=_"Leave a final blow for me! I want to interrogate him!"
		[/message]
	[/event]

	[event]
		name=die
		[filter]
			description=Gawen Hagarthen
		[/filter]
        [filter_second]
			description=Assassin
        [/filter_second]
		[message]
			speaker=Gawen Hagarthen
			message=_"Why? Who have send you?"
		[/message]
		[message]
			speaker=Assassin
			message=_"Why? Two hundred golden pieces, that's why."
		[/message]
	[/event]

	[event]
		name=die
		[filter]
			description=Assassin
		[/filter]
        [filter_second]
			[not]
			description=Lady Lorin
			[/not]
			[not]	
			description=Reme Carrenemoe
			[/not]
        [/filter_second]
		[message]
			speaker=second_unit
			message=_"Die, underling!"
		[/message]
		[message]
			speaker=Lady Lorin
			message=_"Stop, don't kill him! We have to interrogate him!"
		[/message]
		[set_variable]
			name=ano_assa_killed
			value=yes
		[/set_variable]
	[/event]

	[event]
		name=die
		[filter]
			description=Assassin
		[/filter]
        [filter_second]
			description=Reme Carrenemoe
        [/filter_second]
		[message]
			speaker=Reme Carrenemoe
			message=_"Now, only one thing stops me from giving you final blow. Who have send you?"
			image="portraits/reme.png"
		[/message]
		[message]
			speaker=Assassin
			message=_"The destiny."
		[/message]
		[message]
			speaker=Reme Carrenemoe
			message=_"Don't test my patience. Speak, or I will kill you."
			image="portraits/reme.png"
		[/message]
		[message]
			speaker=Assassin
			message=_"Do whatever you want to."
		[/message]
		[message]
			speaker=Reme Carrenemoe
			message=_"Then die, if you want."
			image="portraits/reme.png"
		[/message]
		[message]
			speaker=Lady Lorin
			message=_"You are way too soft, Reme. Why you haven't you given him to me?"
		[/message]
		[set_variable]
			name=ano_assa_killed
			value=yes
		[/set_variable]
	[/event]

	[event]
		name=die
		[filter]
			description=Assassin
		[/filter]
        [filter_second]
			description=Lady Lorin
        [/filter_second]
		[message]
			speaker=Lady Lorin
			message=_"Who have send you!"
		[/message]
		[message]
			speaker=Assassin
			message=_"It's our codex to never betray the name of people who hired us."
		[/message]
		[message]
			speaker=Lady Lorin
			message=_"Don't test my patience, underling! Speak, or you will be sorry you are still alive!"
		[/message]
		[message]
			speaker=Assassin
			message=_"Who have send me? The fate... But there will be another after me. (scream of pain) Aaaargh!"
		[/message]
		[message]
			speaker=Lady Lorin
			message="Speak!"
		[/message]
		[message]
			speaker=Reme Carrenemoe
			message="My lady, please, stop, that's just..."
			image="portraits/reme.png"
		[/message]
		[message]
			speaker=Assassin
			message=_"I can't tell you! (Aaargh) I don't know his name! I was given the task by our elders from Outlaw Place. All I know one of Akladian lords paid him for that in gold! The price was three hundred golden pieces for father and two hundred for son! Aiieeee!!!"
		[/message]
		[message]
			speaker=Lady Lorin	
			message=_"No price for me?"
		[/message]
		[message]
			speaker=Reme Carrenemoe
			message=_"I think he would kill you gratis. He won't say anything more, my lady."
			image="portraits/reme.png"
		[/message]
		[set_variable]
			name=ano_assa_killed
			value=yes
		[/set_variable]
		[set_variable]
			name=ano_assa_interrogated
			value=yes
		[/set_variable]
	[/event]
#enddef

#define RECALL Name
	[recall]
		description={Name}
	[/recall]
#enddef

#define RECALLXY Name X Y
	[recall]
		description={Name}
		x,y={X},{Y}
	[/recall]
#enddef

#define REGVEN_DEATH
	[event]
		name=die
		[filter]
			description=Karl Regven
		[/filter]

		[message]
			speaker=unit
			message= _"I'm not afraid.. I just wanted to smoke a little longer.."
			image="portraits/regven.png"
		[/message]
	[/event]
#enddef

#define YARANOV_DEATH
	[event]
		name=die
		[filter]
			description=Andrey Yaranov
		[/filter]

		[message]
			speaker=Andrey Yaranov
			message= _"Aragwaiths die without fear!"
			image="portraits/yaranov.png"
		[/message]

        [endlevel]
            result=defeat
        [/endlevel]
	[/event]
#enddef
#define LORIN_DEATH
	[event]
		name=die
		[filter]
			description=Lady Lorin
		[/filter]

      [message]
            speaker=Lady Lorin
            message= _"That's not fair!"
			image="portraits/lorin.png"
        [/message]

        [endlevel]
            result=defeat
        [/endlevel]
	[/event]
#enddef

#define CHANGE_TYPE DESC VALUE
		[store_unit]
			[filter]
				description={DESC}
			[/filter]
			kill=yes
			variable=ano_change_side_tmp
		[/store_unit]

		[set_variable]
			name=ano_change_side_tmp.type
			value={VALUE}
		[/set_variable]

		[unstore_unit]
			variable=ano_change_side_tmp
		[/unstore_unit]
		[clear_variable]
			name=ano_change_side_tmp
		[/clear_variable]
#enddef

#define CHANGE_SIDE DESC VALUE
		[store_unit]
			[filter]
				description={DESC}
			[/filter]
			kill=yes
			variable=ano_change_side_tmp
		[/store_unit]

		[set_variable]
			name=ano_change_side_tmp.side
			value={VALUE}
		[/set_variable]

		[set_variable]
			name=ano_change_side_tmp.ai_special
			value=none
		[/set_variable]

		[unstore_unit]
			variable=ano_change_side_tmp
		[/unstore_unit]
		[clear_variable]
			name=ano_change_side_tmp
		[/clear_variable]
#enddef

#define REME_DEATH
	[event]
		name=die
		[filter]
			description=Reme Carrenemoe
		[/filter]

      [message]
            speaker=Reme Carrenemoe
            message= _"I can't hold my sword anymore.. I can't ..."
			image="portraits/reme.png"
        [/message]

        [endlevel]
            result=defeat
        [/endlevel]
	[/event]
#enddef

#define ANO_FPASS_REBEL  WHO
	[if]
		[variable]
			name=ano_fpassrebel
			equals=no
		[/variable]
		[then]
		[message]
			speaker={WHO}
			message=_"Traitors! How can you be so dishonorable to fight against your own rightful king!"
		[/message]
		[message]
			speaker=Oeame
			message=_"Our king is dead! We are no traitors!"
		[/message]
		[message]
			speaker=Reme Carrenemoe
			message=_"But here is king's son, his rightful heir. Are you going to fight him?"
			image="portraits/reme.png"
		[/message]
		[message]	
			speaker=Oeame
			message=_"The king's son is dead! We heard about it!"
		[/message]
		[message]
			speaker=Gawen Hagarthen
			message=_"Do I look like dead to you?"
		[/message]
		[message]
			speaker=Oeame
			message=_"We were deceived! My king, please forgive me!"
		[/message]
		[message]
			speaker=Roule
			message=_"You fool! He is mixling, he can't be our king!"
		[/message]

		{CHANGE_SIDE Oeame 3}
		{CHANGE_TYPE Oeame (Akladian Pikeneer_g)}

		{CHANGE_SIDE Moerro 3}
#ifdef EASY
		{CHANGE_TYPE Moerro (Akladian Light Infantry_g)}
#endif
#ifdef NORMAL
		{CHANGE_TYPE Moerro (Akladian Light Infantry_g)}
#endif
#ifdef HARD
		{CHANGE_TYPE Moerro (Akladian Light Infantry_g)}
#endif

		{CHANGE_SIDE Mirro 3}
		{CHANGE_TYPE Mirro (Akladian Warrior_g)}

		{CHANGE_SIDE Umeari 3}
		{CHANGE_TYPE Umeari (Akladian Warrior_g)}

		{CHANGE_SIDE Rioto 3}
#ifdef EASY
		#{CHANGE_TYPE Rioto (Akladian Shieldguard_g)}
#endif
#ifdef NORMAL
		{CHANGE_TYPE Rioto (Akladian Homeguard_g)}
#endif
#ifdef HARD
		{CHANGE_TYPE Rioto (Akladian Homeguard_g)}
#endif

		{CHANGE_SIDE Lioato 3}
		{CHANGE_TYPE Lioato (Akladian Homeguard_g)}
#ifdef HARD
		{CHANGE_TYPE Lioato (Akladian Warrior_g)}
#endif

		[set_variable]
			name=ano_fpassrebel
			value=yes
		[/set_variable]
	[/then]
	[/if]
#enddef

#define MESSAGE SPEAKER MESSAGE_TEXT
		[message]
			speaker={SPEAKER}
			message=_"{MESSAGE_TEXT}"
		[/message]
#enddef

#define MESSAGE_IMG SPEAKER MESSAGE_TEXT ICON
		[message]
			speaker={SPEAKER}
			message=_"{MESSAGE_TEXT}"
			image={ICON}
		[/message]
#enddef

#define IT_IS_NIGHT
	[variable]
		name=number_tmp
		value=0
	[/variable]
	{VARIABLE_OP number_tmp add $turn_number}
	{VARIABLE_OP number_tmp multiply 0.5}
	[message]
		speaker=narrator
		message="HEJ HO" $number_tmp
	[/message]
	
	[clear_variable]
		name=number_tmp
	[/clear_variable]
#enddef

#define VARUNIT ARRAY INDEX UNIT
	{VARIABLE ({ARRAY}[{INDEX}].description) (${UNIT}.description)}
	{VARIABLE ({ARRAY}[{INDEX}].experience) (${UNIT}.experience)}
	{VARIABLE ({ARRAY}[{INDEX}].gender) (${UNIT}.gender)}
	{VARIABLE ({ARRAY}[{INDEX}].type) (${UNIT}.type)}
	{VARIABLE ({ARRAY}[{INDEX}].unrenamable) (${UNIT}.unrenamable)}
	{VARIABLE ({ARRAY}[{INDEX}].upkeep) (${UNIT}.upkeep)}
	{VARIABLE ({ARRAY}[{INDEX}].user_description) (${UNIT}.user_description)}
	{FOREACH ({UNIT}.modifications.trait) arr_in}
	{VARIABLE ({ARRAY}[{INDEX}].traits) (${UNIT}.modifications.trait[$arr_in].id)}
	{NEXT arr_in}
#enddef

#define FVAR VAR1 VAR2
	[set_variable]
		name={VAR1}
		format={VAR2}
	[/set_variable]
#enddef

#define VARTOUNIT ARRAY INDEX SIDE X Y
	{FVAR (desc_tmp) (${ARRAY}[{INDEX}].description) }
	{FVAR (u_tmp) (${ARRAY}[{INDEX}].user_description) }
	{FVAR (exp_tmp) (${ARRAY}[{INDEX}].experience)}
	{FVAR (gender_tmp) (${ARRAY}[{INDEX}].gender) }
	{FVAR (type_tmp) (${ARRAY}[{INDEX}].type)}
	{FVAR (upkeep_tmp) (${ARRAY}[{INDEX}].upkeep)}

	{FVAR (id_tmp) (${ARRAY}[{INDEX}].traits)}
#Only ONE trait is saved: intelligent,strong,quick, resilient, otherwise loyal

	[if]
		[variable]
			name=id_tmp
			equals="resilient"
		[/variable]
		[then]
		[unit]
		  description=$desc_tmp
		experience=$exp_tmp
		type=$type_tmp
			x={X}
			y={Y}
			side={SIDE}
			gender=$gender_tmp
			upkeep=$upkeep_tmp
			user_description=$u_tmp
			[modifications]
				{TRAIT_RESILIENT}
			[/modifications]
		[/unit]
		[/then]

		[else]
	[if]
		[variable]
			name=id_tmp
			equals="quick"
		[/variable]
		[then]
		[unit]
		  description=$desc_tmp
		experience=$exp_tmp
		type=$type_tmp
			x={X}
			y={Y}
			side={SIDE}
			gender=$gender_tmp
			upkeep=$upkeep_tmp
			user_description=$u_tmp
			[modifications]
				{TRAIT_QUICK}
			[/modifications]
		[/unit]
		[/then]
			[else]
				[if]
					[variable]
						name=id_tmp
						equals="strong"
					[/variable]
					[then]
					[unit]
					  description=$desc_tmp
					experience=$exp_tmp
					type=$type_tmp
						x={X}
						y={Y}
						side={SIDE}
						gender=$gender_tmp
						upkeep=$upkeep_tmp
						user_description=$u_tmp
						[modifications]
							{TRAIT_STRONG}
						[/modifications]
					[/unit]
					[/then]
						[else]
							[if]
								[variable]
									name=id_tmp
									equals="intelligent"
								[/variable]
								[then]
								[unit]
								  description=$desc_tmp
								experience=$exp_tmp
								type=$type_tmp
									x={X}
									y={Y}
									side={SIDE}
									gender=$gender_tmp
									upkeep=$upkeep_tmp
									user_description=$u_tmp
									[modifications]
										{TRAIT_INTELLIGENT}
									[/modifications]
								[/unit]
								[/then]
							[else]
								[unit]
								  description=$desc_tmp
								experience=$exp_tmp
								type=$type_tmp
									x={X}
									y={Y}
									side={SIDE}
									gender=$gender_tmp
									upkeep=$upkeep_tmp
									user_description=$u_tmp
									[modifications]
										{TRAIT_LOYAL}
									[/modifications]
								[/unit]
						[/else]
								[/if]
						[/else]
					[/if]
			[/else]
			[/if]
		[/else]
	[/if]
	{CLEAR_VARIABLE u_tmp}
	{CLEAR_VARIABLE desc_tmp}
	{CLEAR_VARIABLE exp_tmp}
	{CLEAR_VARIABLE type_tmp}
	{CLEAR_VARIABLE gender_tmp}
	{CLEAR_VARIABLE upkeep_tmp}
	{CLEAR_VARIABLE id_tmp}

#enddef


#define ANO4_TRAITORS OBJECTIVE
		{MESSAGE ("Lady Lorin") (No! That's impossible! You will pay for that, treacherous dogs! Your sons at Vattin are already dead!)}
		{MESSAGE_IMG ("Bor Cryne") (You really thought I would send my true son to Vattin? You are so easy to fool! That boy who is at Vattin is not my first born son. Now, prepare to go straight to hell.) (portraits/bor_cryne.png)}
		{MESSAGE_IMG ("Reme Carrenemoe") (This isn't a totally surprising to me. My king, we have to escape. We have two ways to out of this trap: one to the west...) (portraits/reme.png)}
		[scroll_to]
			x,y=1,9
		[/scroll_to]
		[redraw] 
		[/redraw]
		[delay] 
			tirme=500
		[/delay]
		{MESSAGE_IMG ("Reme Carrenemoe") (And second to the east.) (portraits/reme.png)}
		[scroll_to]
			x,y=32,20
		[/scroll_to]
		[redraw] 
		[/redraw]
		[delay] 
		time=500 
		[/delay]
		{MESSAGE ("Gawen Hagarthen") (Which one is better?)}
		{MESSAGE_IMG ("Reme Carrenemoe") (There is no difference, really. We can use both to reach Vattin. Eastern one leads amongst swamps and forests, while western through the hills and grasslands. God, I oath to sacrifice a horse if you will help us survive this. A whole, beatiful horse. And I will add golden saddle!) (portraits/reme.png)}
		{MESSAGE ("Gawen Hagarthen") (Reme, take my step-mother and protect her. I will stay here to guard your rear during withdrawal.)}
		{MESSAGE ("Lady Lorin") (No! That's a suicide! I won't let you!)}
		{MESSAGE ("Gawen Hagarthen") (Reme, take her and go. That's my order. And that is no suicide, I will follow you as soon as possible.)}
		{MESSAGE_IMG ("Reme Carrenemoe") (I can't. I won't. I won't leave you, my lord.) (portraits/reme.png)}
		{MESSAGE ("Gawen Hagarthen") (That's an order. Reme, if I will run away first, who will respect me? I am not suicidal, believe me. And you must live, I order you to escort Lady Lorin safely to either Vattin or her family.)}

	[objectives]
		side=1
		note="
Any unit which will reach either of the signpost will be evacuated. Units not recalled will be lost. Gawen must not escape, or he would be considered unworthy coward by his soldiers. You will get a bonus for each turn resisted above the required limit."
		[objective]
			description={OBJECTIVE}
			condition=win
		[/objective]
		[objective]
			description=Death of Lady Lorin
			condition=lose
		[/objective]
		[objective]
			description=Death of Reme Carrenemoe
			condition=lose
		[/objective]
		[objective]
			description=Cowardly escape of Gawen Hagarthen
			condition=lose
		[/objective]
	[/objectives]
	[set_variable]	
		name=ano_barnon_tr
		value=yes
	[/set_variable]
#enddef

#define STOREUNIT X Y
	[store_unit]
		[filter]
			x={X}
			y={Y}
		[/filter]
		variable=ano_units_tmp
		kill=yes
	[/store_unit]

	{VARUNIT ano_units $ano_units_last_index ano_units_tmp}
	{VARIABLE_OP ano_units_last_index add 1}
#enddef

#define EVACUATE X Y
	[event]
		name=moveto
		first_time_only=no
		[filter]
			x={X}
			y={Y}
			side=1
			[not]
				description=Lady Lorin
			[/not]
			[not]
				description=Reme Carrenemoe
			[/not]
			[not]
				description=Gawen Hagarthen
			[/not]
		[/filter]

		[if]
			[variable]	
				name=ano_barnon_tr
				equals=yes
			[/variable]
		[then]
		{STOREUNIT ({X}) ({Y})}
		[/then]
		[/if]
	[/event]

	[event]
		name=moveto
		[filter]
			x={X}
			y={Y}
			side=1
			description=Gawen Hagarthen
		[/filter]
		[if]
			[variable]	
				name=ano_barnon_tr
				equals=yes
			[/variable]
		[then]

		{MESSAGE ("Gawen Hagarthen") (I can't just run away. I don't want to. I would prefer dying here, fighting.)}
		[/then]
		[/if]
	[/event]

	[event]
		name=moveto
		first_time_only=no
		[filter]
			x={X}
			y={Y}
			side=1
			description=Reme Carrenemoe
		[/filter]
		[if]
			[variable]	
				name=ano_barnon_tr
				equals=yes
			[/variable]
		[then]
		[if]
			[variable]
				name=ano_lorin_escaped
				equals=yes
			[/variable]
			[variable]
				name=ano_lorin_via
				not_equals={X}
			[/variable]
		[then]
				{MESSAGE ("Gawen Hagarthen") (Reme, you had to take care of Lorin. She went the other way)}
		[/then]
		[else]

		{MESSAGE ("Gawen Hagarthen") (Take care, Reme Carrenemoe.)}
		{MESSAGE_IMG ("Reme Carrenemoe") (Respect, my king. Follow us as soon as it is possible) (portraits/reme.png)}
		{MESSAGE ("Gawen Hagarthen") (Yes... of course. I'm afraid that means.. never.)}
		[set_variable]
			name=ano_reme_escaped
			value=yes
		[/set_variable]
		[set_variable]
			name=ano_reme_via
			value={X}
		[/set_variable]
		[store_unit]
			[filter]
			x={X}
			y={Y}
			[/filter]
			variable=ano_reme_stored
			kill=yes
		[/store_unit]
		[/else]
		[/if]
		[/then]
		[/if]
	[/event]
	[event]
		name=moveto
		first_time_only=no
		[filter]
			x={X}
			y={Y}
			side=1
			description=Lady Lorin
		[/filter]

		[if]
			[variable]	
				name=ano_barnon_tr
				equals=yes
			[/variable]
		[then]
			[if]
				[variable]
					name=ano_reme_escaped
					equals=yes
				[/variable]
				[variable]
					name=ano_reme_via
					not_equals={X}
				[/variable]
			[then]
				{MESSAGE (Gawen Hagarthen) (Lorin, you have to go the other way. Reme is waiting for you there!)}
			[/then]
			[else]
				{MESSAGE ("Lady Lorin") (No! I won't leave you! I don't want to! Let's die together!)}
				{MESSAGE ("Gawen Hagarthen") (Take her to the safety, people.)}
				[set_variable]
					name=ano_lorin_escaped
					value=yes
				[/set_variable]
				[set_variable]
					name=ano_lorin_via
					value={X}
				[/set_variable]
				[store_unit]
					[filter]
					x={X}
					y={Y}
					[/filter]
					variable=ano_lorin_stored
					kill=yes
				[/store_unit]
			[/else]
			[/if]
		[/then]
		[/if]
	[/event]
#enddef

#define STORERECALL ANO_LIST
	[recall]
		side=1
		x=1
		y=1
	[/recall]
	
	[if]	
		[have_unit]
			x=1
			y=1
		[/have_unit]
		[then]
			[set_variable]
				name=ano_ok_tmp
				value=yes
			[/set_variable]
			[store_unit]
				[filter]
					x=1
					y=1
				[/filter]
				variable=ano_units_tmp
				kill=yes
			[/store_unit]

			{VARUNIT ({ANO_LIST}) $ano_recalls_last_index ano_units_tmp}
			{VARIABLE_OP ano_recalls_last_index add 1}
		[/then]
		[else]
			[set_variable]
				name=ano_ok_tmp
				value=no
			[/set_variable]
		[/else]
		[/if]
#enddef

#define RECALL_ALL
		[set_variable]
			name=ano_ok_tmp
			value=yes
		[/set_variable]
	[while]
		[variable]
			name=ano_ok_tmp
			equals=yes
		[/variable]
		[do]
			[recall]
				side=1
				x=1
				y=1
			[/recall]
			[if]
				[have_unit]
					x=1
					y=1
				[/have_unit]
				[then]
					[teleport]
						[filter]
						x=1
						y=1
						[/filter]
					x=10
					y=10
					[/teleport]
				[/then]
				[else]
				{VARIABLE ano_ok_tmp no}
				[/else]
			[/if]
		[/do]
	[/while]
	[clear_variable]
		name=ano_ok_tmp
	[/clear_variable]
#enddef

#define RECALL_AND_STORE_ALL ANO_LIST
	{VARIABLE ano_recalls_last_index 0}
		[set_variable]
			name=ano_ok_tmp
			value=yes
		[/set_variable]
	[while]
		[variable]
			name=ano_ok_tmp
			equals=yes
		[/variable]
		[do]
		{STORERECALL ({ANO_LIST}) }
		[/do]
	[/while]
	[clear_variable]
		name=ano_ok_tmp
	[/clear_variable]
#enddef

#define KAREN_DEATH
	[event]
		name=die
		[filter]
			description=Karen
		[/filter]
		[message]
			speaker=Karen
			message=_"Father! Father! I am loosing my..."
			image="portraits/karen.png"
		[/message]
		[endlevel]	
			result=defeat
		[/endlevel]
	[/event]
#enddef

#define RUVIO_DEATH
	[event]
		name=die
		[filter]
			description=Ruvio
		[/filter]

		[message]
			speaker=Ruvio
			message=_"No! I have still so much to do!"
			image="portraits/ruvio.png"
		[/message]
		[endlevel]	
			result=defeat
		[/endlevel]
	[/event]
#enddef

#define CHECKVER
	[if]
		[variable]
			name=ano_warned
			equals=yes
		[/variable]
		[then]
		[/then]
		[else]
			{VARIABLE ano_warned yes}
			{MESSAGE (narrator) (There were a lot of bugs in releases of A New Order before 0.0.9. If you have played beyond scenario 'Battle of Barnon' you may want either to send to author a savegame, so I could freely correct improper informations saved in savegames, or start game again from Battle of Barnon. I apologise for inconvenience. Also, post feedback - no matter positive or negative - on forum. My email: adanilecki at cs put poznan pl)}
		[/else]
	[/if]
#enddef

#define ANOVER
	[if]
		[variable]
			name=ano_version
			equals=0.1.4
		[/variable]
		[then]
		[/then]
		[else]
			{VARIABLE ano_version 0.1.4}
			{MESSAGE (narrator) (This is version 0.1.4. Detailed changelog is posted on forum, also you may find it in the same directory in which campaign files are located. If you like this campaign post your feedback on www.wesnoth.org/forum. Your input will help me to make it better and will encourage me to put more work into it. Next release, probably mostly bug fixes and balancing, may be expected at this Thursday, 04-08-2005 - szopen)}
		[/else]
	[/if]
#enddef

#define CHECKGAWEN
	[if]
		[variable]
			name=ano_gawen_is_stored
			equals=yes
		[/variable]
		[then]
		[/then]
		[else]
			{VARIABLE ano_gawen_is_stored yes}
			{MESSAGE (narrator) (There was a bug in release 0.1.0 causing Gawen and his units to lost between scenarios. Please, either play the scenario Outlaw Base - this with Rob Roe - again from the very beginning, or copy manually the missing units from savegame Hired_Swords to savegame Council_In_Freetown. You may post your savegame to me, adanilecki at cs put poznan pl, and I will correct the savegame for you and I will send it back. This warning will appear only once.)}
		[/else]
	[/if]
#enddef

#define CLEAR_RECALL
		[set_variable]
			name=ano_ok_tmp
			value=yes
		[/set_variable]
	[while]
		[variable]
			name=ano_ok_tmp
			equals=yes
		[/variable]
		[do]
			[recall]
				side=1
				x=1
				y=1
			[/recall]
			
			[if]	
				[have_unit]
					x=1
					y=1
					side=1
				[/have_unit]
				[then]
					[set_variable]
						name=ano_ok_tmp
						value=yes
					[/set_variable]
					[store_unit]
						[filter]
							x=1
							y=1
						[/filter]
						variable=ano_units_tmp
						kill=yes
					[/store_unit]
					{CLEAR_VARIABLE ano_units_tmp}
				[/then]
				[else]
					[set_variable]
						name=ano_ok_tmp
						value=no
					[/set_variable]
				[/else]
				[/if]
		[/do]
	[/while]
	[clear_variable]
		name=ano_ok_tmp
	[/clear_variable]
#enddef

#define MOVETO X Y DESC
	name=moveto
	[filter]
		x={X}
		y={Y}
		description={DESC}
	[/filter]
#enddef

#define LABEL X Y TEXT
[label]
	x={X}
	y={Y}
	text=_"{TEXT}"
[/label]
#enddef	

#define NOTIMPLEMENTED
	[message]
		speaker=narrator
		message=_"This is not implemented in current version of the scenario. Please, wait at least one week and download new campaign version from campaign server to see whether it will be implemented"
	[/message]
#enddef

#define DEBUGMSG0
	[message]
		speaker=narrator
		message=_"This is debug message." 
	[/message]
#enddef

#define NEXT_SCENARIO RESULT SCENARIO
	[endlevel]
		next_scenario={SCENARIO}
		result={RESULT}
	[/endlevel]
#enddef
	
#define VARLOG VAR LOG VAL
	[variable]
		name={VAR}	
		{LOG}={VAL}
	[/variable]
#enddef

#define MSGOPTION OPTION VAL
	[option]
		message=_"{OPTION}"

		[command]
			{VARIABLE ano_opt ({VAL}) }
		[/command]
	[/option]
#enddef

#define MSGOPT2 SPEAKER MSG OPTION1 VAL1 OPTION2 VAL2
	[message]
		speaker={SPEAKER}
		message={MSG}

		{MSGOPTION ({OPTION1}) ({VAL1})}
		{MSGOPTION ({OPTION2}) ({VAL2})}
	[/message]
#enddef

#define MSGOPT3 SPEAKER MSG OPTION1 VAL1 OPTION2 VAL2 OPTION3 VAL3
	[message]
		speaker={SPEAKER}
		message={MSG}

		{MSGOPTION ({OPTION1}) ({VAL1})}
		{MSGOPTION ({OPTION2}) ({VAL2})}
		{MSGOPTION ({OPTION3}) ({VAL3})}
	[/message]
#enddef

#define MSGOPT4 SPEAKER MSG OPTION1 VAL1 OPTION2 VAL2 OPTION3 VAL3 OPTION4 VAL4
	[message]
		speaker={SPEAKER}
		message={MSG}

		{MSGOPTION ({OPTION1}) ({VAL1})}
		{MSGOPTION ({OPTION2}) ({VAL2})}
		{MSGOPTION ({OPTION3}) ({VAL3})}
		{MSGOPTION ({OPTION4}) ({VAL4})}
	[/message]
#enddef

#define MSGOPT5 SPEAKER MSG OPTION1 VAL1 OPTION2 VAL2 OPTION3 VAL3 OPTION4 VAL4 OPTION5 VAL5
	[message]
		speaker={SPEAKER}
		message={MSG}

		{MSGOPTION ({OPTION1}) ({VAL1})}
		{MSGOPTION ({OPTION2}) ({VAL2})}
		{MSGOPTION ({OPTION3}) ({VAL3})}
		{MSGOPTION ({OPTION4}) ({VAL4})}
		{MSGOPTION ({OPTION5}) ({VAL5})}
	[/message]
#enddef

#define MSGOPTI2 SPEAKER MSG IMG OPTION1 VAL1 OPTION2 VAL2
	[message]
		speaker={SPEAKER}
		message={MSG}
		image={IMG}

		{MSGOPTION ({OPTION1}) ({VAL1})}
		{MSGOPTION ({OPTION2}) ({VAL2})}
	[/message]
#enddef

#define MSGOPTI3 SPEAKER MSG IMG OPTION1 VAL1 OPTION2 VAL2 OPTION3 VAL3
	[message]
		speaker={SPEAKER}
		message={MSG}
		image={IMG}

		{MSGOPTION ({OPTION1}) ({VAL1})}
		{MSGOPTION ({OPTION2}) ({VAL2})}
		{MSGOPTION ({OPTION3}) ({VAL3})}
	[/message]
#enddef

#define MSGOPTI4 SPEAKER MSG IMG OPTION1 VAL1 OPTION2 VAL2 OPTION3 VAL3 OPTION4 VAL4
	[message]
		speaker={SPEAKER}
		message={MSG}
		image={IMG}

		{MSGOPTION ({OPTION1}) ({VAL1})}
		{MSGOPTION ({OPTION2}) ({VAL2})}
		{MSGOPTION ({OPTION3}) ({VAL3})}
		{MSGOPTION ({OPTION4}) ({VAL4})}
	[/message]
#enddef

#define MSGOPTI5 SPEAKER MSG IMG OPTION1 VAL1 OPTION2 VAL2 OPTION3 VAL3 OPTION4 VAL4 OPTION5 VAL5
	[message]
		speaker={SPEAKER}
		message={MSG}
		image={IMG}

		{MSGOPTION ({OPTION1}) ({VAL1})}
		{MSGOPTION ({OPTION2}) ({VAL2})}
		{MSGOPTION ({OPTION3}) ({VAL3})}
		{MSGOPTION ({OPTION4}) ({VAL4})}
		{MSGOPTION ({OPTION5}) ({VAL5})}
	[/message]
#enddef

#define MSGOPTI6 SPEAKER MSG IMG OPTION1 VAL1 OPTION2 VAL2 OPTION3 VAL3 OPTION4 VAL4 OPTION5 VAL5 OPTION6 VAL6
	[message]
		speaker={SPEAKER}
		message={MSG}
		image={IMG}

		{MSGOPTION ({OPTION1}) ({VAL1})}
		{MSGOPTION ({OPTION2}) ({VAL2})}
		{MSGOPTION ({OPTION3}) ({VAL3})}
		{MSGOPTION ({OPTION4}) ({VAL4})}
		{MSGOPTION ({OPTION5}) ({VAL5})}
		{MSGOPTION ({OPTION6}) ({VAL6})}
	[/message]
#enddef
#define MSGLORIN TEXT
{MESSAGE (Lady Lorin) ({TEXT})}
#enddef

#define TELEPORT UNIT X Y
[teleport]
	[filter]
		description={UNIT}
	[/filter]
	x,y={X},{Y}
[/teleport]

#enddef	
